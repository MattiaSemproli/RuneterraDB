<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

	<head>
		<title>RuneterraDB | Profile creation</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<link rel="stylesheet" href="../assets/css/form.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>

	<body>

		<!-- Header -->
		<header id="header" class="alt">
			<nav>
                Welcome new user! Please create your profile!
			</nav>
		</header>

		<!-- Banner -->
		<section id="banner">
			<div class="inner">
				<form action="../php/profileCreation.php" method="POST">
                    <label for="summonerName">Summoner name:</label>
                    <input type="text" id="summonerName" name="summonerName" placeholder="Insert summoner name..." autocomplete="off" required>

                    <label for="team">Team:</label>
                    <input type="text" id="team" name="team" autocomplete="off" required>

					<input type="submit" id="createProfile" value="Create profile" disabled>
				</form>
			</div>
		</section>

		<script>
			window.addEventListener('load', function() {
				var xhr = new XMLHttpRequest();
				xhr.open('GET', '../php/availableTeam.php', true);
				xhr.onload = function() {
					if (xhr.status === 200) {
						var teams = JSON.parse(xhr.responseText);
						document.cookie = "teams=" + JSON.stringify(teams) + "; path=/html/profileCreation.html;";
						process(teams);
					} else {
						console.log('Error in the request: ' + xhr.status);
					}
				};
				xhr.send();
			});

			function process(teams) {
				var t = document.getElementById('team');
				if(teams.length == 0) {
					t.setAttribute('placeholder', 'No teams available');
				} else {	
					var availableTeamsPH = 'Available teams: ' + teams.join(', '); //PH = placeholder.
					t.setAttribute('placeholder', availableTeamsPH);
				}
			}

			const input = document.getElementById('team');
			const submitBtn = document.getElementById('createProfile');

			input.addEventListener('input', () => {
				var cookieValue = document.cookie
										  .split('; ')
										  .find(cookie => cookie.startsWith('teams='))
										  ?.split('=')[1];
				var freeTeams = Array();
				if(cookieValue)
					JSON.parse(cookieValue).map(team => team.toLowerCase().replace(/\s+/g, '')).forEach(element => {	
						freeTeams.push(element);
					});

				if (freeTeams.includes(input.value.toLowerCase().replace(/\s+/g, ''))) {
					submitBtn.disabled = false;
				} else {
					submitBtn.disabled = true;
				}
			});

			//clear the cookie before leaving the page.
			window.onbeforeunload = function() {
				document.cookie = "teams=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/html/profileCreation.html;";
			};
		</script>

		<!-- Footer -->
		<footer id="footer">
			<div class="inner">
				<ul class="copyright">
					<li>&copy; All rights reserved to Mattia Semproli & Martino Pagliarani</li>
				</ul>
			</div>
			</section>

			<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>

	</body>

</html>